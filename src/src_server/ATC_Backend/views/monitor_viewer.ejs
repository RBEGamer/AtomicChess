<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/landing-page.css" rel="stylesheet">
  <link href="/css/lightbox.min.css" rel="stylesheet">
  <link href="/css/photo_gallery.css" rel="stylesheet">
  <link href="/ionicons/css/ionicons.min.css" rel="stylesheet">
  <link href="/css/faq.css" rel="stylesheet">
  <link href="/css/main.css" rel="stylesheet">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="AtomicChess">
  <meta name="author" content="Marcel Ochsendorf">
  <meta http-equiv="cache-control" content="max-age=0" />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
  <meta http-equiv="pragma" content="no-cache" />

  <link href="/css/dashboard_main.css" rel="stylesheet">
  <link href="/css/dashboard_cards.css" rel="stylesheet">
  <link rel="stylesheet" href="/js/PGNViewer/css/pgnvjs.css">
  <link href="/css/font-awesome.min.css" rel="stylesheet">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="AtomicChess">
  <meta name="author" content="Marcel Ochsendorf">
  <meta http-equiv="cache-control" content="max-age=0" />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
  <meta http-equiv="pragma" content="no-cache" />
  <title>ATC BACKEND</title>
</head>

<body class="container">

<nav class="navbar navbar-expand-lg navbar-light bg-light">

  <a class="navbar-brand" href="/"><img width="64px"  src="/img/icons/chess_icon.png"><b>AtomicChess -  WATCH PLAYER BOARD</b></a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item">
        <a class="nav-link" id="" href="/">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="" href="/playerlist">Playerlist</a>
      </li>
    </ul>
  </div>
</nav>










<div class="row justify-content-center">
  <div class="col-md-12">
    <div class="card">
      <div class="card-body" id="game_information_container">
        <div class="text-center">
          <p class="card-content" id="game_info"></p>



          <div class="row justify-content-center">
            <div class="col-md-4 text-center">


          <div class="row top-buffer"></div>


          <div class="row justify-content-center">
          </div>
          <div class="row top-buffer"></div>
          <div class="row justify-content-center">
            <div class="col-md-12 d-flex justify-content-center">
              <div id="current_board" style="width: 400px"><img width="400px" src="/img/board_placeholder_400x400.png"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>




<script src="/js/jquery/jquery.min.js"></script>
<script src="/bootstrap/js/bootstrap.min.js"></script>
<script src="/js/PGNViewer/js/pgnvjs.js"></script>


<script>

  //GLOBAL VARIABLES
  var current_board = null;
  var loaded_pid = null;
  var last_fen = "";



  //SORTING TIMESTAMP
  function compare_created_timestamp( b, a ) {
    if ( a.created_timestamp < b.created_timestamp ){
      return -1;
    }
    if ( a.created_timestamp > b.created_timestamp ){
      return 1;
    }
    return 0;
  }
  //PARSES THE QUERY STRING IN THE URL
  //https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
  function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
  }



  //LOADS MORE INFORMATION ABOUT A SPECIFIC GAME ID
  function load_game_information(_id, _update_only){

    $.getJSON('/rest/get_board_by_player?pid=' +_id,function (data) {
      //PROCESS GOT GAME LIST RESULT
     // debugger;

      if(!data || data.err || !data.data ||!data.data.game_data){
        return;
      }

      console.log(data.data);
      //SHOW ID

      //DISPLAY CURRENT BOARD
      if(data.data.game_data.current_board.fen){

        if(last_fen === data.data.game_data.current_board.fen){
          return;
        }
        last_fen = data.data.game_data.current_board.fen;

        //CREATE BOARD INSTANCE FIRST TIME
        if(!_update_only) {
          $("#current_board").html("");
          current_board = pgnBoard('current_board', { position: last_fen, locale: 'en', pieceStyle: 'wikipedia', theme:'falken' });
          return;
        }
        current_board = pgnBoard('current_board', { position: last_fen, locale: 'en', pieceStyle: 'wikipedia', theme:'falken' });
      }
    });
  }

  //EXECUTES SCRIPT IF PAGE LOADED
  $(document).ready(function () {
    //CHECK QUERY PARAMETER TO LOAD A GAME DIRECTLY
    loaded_pid = getParameterByName("pid");
    if(loaded_pid === undefined){
      window.location.href = "/playerlist";
    }

    load_game_information(loaded_pid);

    //START POLLING REFRESH TIMER
    var update_timer = setInterval(function (){
      if(loaded_pid != null && loaded_pid !== ""){
        load_game_information(loaded_pid,true);
      }
    },1000);
  });
</script>

</body>

</html>